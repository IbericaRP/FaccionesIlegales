<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Chat Ibercia</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0f0f0f;
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 30px;
    }
    #chat-box {
      border: 2px solid #444;
      border-radius: 10px;
      width: 90%;
      max-width: 600px;
      height: 400px;
      overflow-y: auto;
      padding: 10px;
      background: #1a1a1a;
      margin-bottom: 20px;
    }
    #input {
      width: 90%;
      max-width: 600px;
      padding: 10px;
      font-size: 16px;
    }
    #send {
      padding: 10px 20px;
      font-size: 16px;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h2>Chat Ibercia</h2>
  <div id="chat-box"></div>
  <input type="text" id="input" placeholder="Escribe tu mensaje...">
  <button id="send">Enviar</button>

  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

  <script>
    // Configuración Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyAAihYPChiJC61hazahxbHKgv384UE9HUU",
      authDomain: "ibericachatdrknt.firebaseapp.com",
      databaseURL: "https://ibericachatdrknt-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "ibericachatdrknt",
      storageBucket: "ibericachatdrknt.appspot.com",
      messagingSenderId: "933093011275",
      appId: "1:933093011275:web:645bd6ea82dcc022fc02ce",
      measurementId: "G-D0RNWWQXLS"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Datos
    const bannedWords =[
    'puta', 'putá', 'puto', 'putó', 'putos', 'putós', 'putas', 'putás',
    'mierda', 'mierdá',
    'coño',
    'gilipollas',
    'joder',
    'cabrón', 'cabron', 'cabrona',
    'cabrones', 'cabrónes',
    'culo',
    'polla',
    'pene',
    'verga',
    'chingar', 'chingado', 'chingadó', 'chingada', 'chingáda', 'chingados', 'chingádos',
    'chingonas', 'chingónas', 'chingón', 'chingon',
    'hostia',
    'zorra',
    'tonto', 'tonta',
    'imbecil',
    'idiota',
    'subnormal',
    'bastardo',
    'estúpido', 'estupido',
    'pendejo', 'pendeja',
    'tarado', 'tarada',
    'maldito', 'maldita',
    'puta madre',
    'hijo de puta',
    'pinche',
    'carajo',
    'maricón', 'maricon',
    'maricona',
    'mariconez',
    'pedo',
    'pedocha',
    'mamón', 'mamon',
    'puta que te parió', 'puta que te pario',
    'me cago en',
    'me cago en todo',
    'la concha de tu madre',
    'cojones',
    'puta mierda',
    'mierda de mierda',
    'facha',
    'nazi',
    'racista',
    'homófobo', 'homofobo',
    'terrorista',
    'cabronazo',
    'chinga tu madre',
    'malparido', 'malparida',
    'chupapollas',
    'pajero', 'pajera',
    'cerdo', 'cerda',
    'bicho raro',
    'puta de mierda',
    'fuck', 'shit', 'bitch', 'asshole', 'damn', 'bastard', 'bollocks'
  ];
    const TIMEOUT_DURATION = 5 * 60 * 1000; // 5 minutos

    let username = localStorage.getItem("username") || prompt("Nombre de usuario:");
    localStorage.setItem("username", username);

    let pass = prompt("Introduce la contraseña para acceder al chat:");
    if (pass !== "chatibercia123") {
      alert("Contraseña incorrecta. Acceso denegado.");
      throw new Error("Acceso denegado");
    } else {
      db.ref("users/" + username).set({ password: pass });
    }

    let isBanned = localStorage.getItem("banned") === "true";
    let timeouts = parseInt(localStorage.getItem("timeouts") || "0");

    if (isBanned) {
      alert("Has sido baneado permanentemente. Contacta con un administrador.");
      throw new Error("Usuario baneado");
    }

    const chatBox = document.getElementById("chat-box");
    const input = document.getElementById("input");
    const send = document.getElementById("send");

    function addMessage(msg) {
      chatBox.innerHTML += `<div>${msg}</div>`;
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    send.onclick = () => {
      const message = input.value.trim();
      if (!message) return;

      if (isBanned) {
        alert("Estás baneado. No puedes enviar mensajes.");
        return;
      }

      let lower = message.toLowerCase();
      if (bannedWords.some(word => lower.includes(word))) {
        timeouts++;
        localStorage.setItem("timeouts", timeouts);
        if (timeouts >= 5) {
          localStorage.setItem("banned", "true");
          alert("Has sido baneado permanentemente por lenguaje inapropiado.");
        } else {
          alert(`Palabra prohibida detectada. Timeout de 5 minutos.\n(${timeouts}/5) Si llegas a 5, serás baneado.`);

          input.disabled = true;
          send.disabled = true;
          setTimeout(() => {
            input.disabled = false;
            send.disabled = false;
            alert("Tu timeout ha terminado. Puedes volver a escribir.");
          }, TIMEOUT_DURATION);
        }
        return;
      }

      // Comandos de administrador
      if (username === "Anon4397" || username === "Anon7919") {
        if (message === "!listaUsuarios") {
          db.ref("users").once("value", snap => {
            let data = snap.val();
            let list = Object.keys(data || {}).join(", ");
            addMessage("[ADMIN] Usuarios: " + list);
          });
          input.value = "";
          return;
        }
        if (message === "!listaPasswords") {
          db.ref("users").once("value", snap => {
            let data = snap.val();
            let list = Object.entries(data || {}).map(([k,v]) => `${k}: ${v.password}`).join("<br>");
            addMessage("[ADMIN] Contraseñas:<br>" + list);
          });
          input.value = "";
          return;
        }
      }

      addMessage(`<b>${username}:</b> ${message}`);
      input.value = "";
    };
  </script>
</body>
</html>
