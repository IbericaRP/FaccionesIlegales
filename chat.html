<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Chat Anónimo</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #121212;
      color: white;
      padding: 20px;
    }
    #chat {
      max-height: 400px;
      overflow-y: auto;
      border: 1px solid #444;
      padding: 10px;
      margin-bottom: 10px;
      background: #1e1e1e;
    }
    .message {
      margin-bottom: 10px;
    }
    .anon {
      color: #66ff66;
    }
  </style>
</head>
<body>

<h2>Chat Anónimo</h2>
<div id="chat"></div>

<input type="text" id="messageInput" placeholder="Escribe tu mensaje..." />
<button onclick="sendMessage()">Enviar</button>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
  // Configuración Firebase con databaseURL CORRECTO
  const firebaseConfig = {
    apiKey: "AIzaSyAAihYPChiJC61hazahxbHKgv384UE9HUU",
    authDomain: "ibericachatdrknt.firebaseapp.com",
    databaseURL: "https://ibericachatdrknt-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "ibericachatdrknt",
    storageBucket: "ibericachatdrknt.appspot.com",
    messagingSenderId: "933093011275",
    appId: "1:933093011275:web:645bd6ea82dcc022fc02ce",
    measurementId: "G-D0RNWWQXLS"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // Guardar y reutilizar usuario en localStorage
  let username = localStorage.getItem("anonUser");
  if (!username) {
    username = "Anon" + Math.floor(Math.random() * 10000);
    localStorage.setItem("anonUser", username);
  }

  // Lista de palabras prohibidas (todo en minúsculas)
  const bannedWords = ["mala", "tonta", "idiota", "prohibida", "palabrota"];

  function containsBannedWord(text) {
    const lowerText = text.toLowerCase();
    return bannedWords.some(word => lowerText.includes(word));
  }

  function sendMessage() {
    const msg = document.getElementById("messageInput").value.trim();
    if (msg === "") return;

    if (containsBannedWord(msg)) {
      alert("Tu mensaje contiene palabras prohibidas y no puede ser enviado.");
      return;
    }

    db.ref("mensajes").push({
      user: username,
      text: msg
    });
    document.getElementById("messageInput").value = "";
  }

  const chatDiv = document.getElementById("chat");

  db.ref("mensajes").on("child_added", function(snapshot) {
    const msg = snapshot.val();
    const div = document.createElement("div");
    div.classList.add("message");
    div.innerHTML = `<span class="anon">${msg.user}:</span> ${msg.text}`;
    chatDiv.appendChild(div);
    chatDiv.scrollTop = chatDiv.scrollHeight;
  });

  // Enviar mensaje con tecla Enter
  document.getElementById("messageInput").addEventListener("keydown", function(event) {
    if (event.key === "Enter") {
      sendMessage();
    }
  });
</script>

</body>
</html>
